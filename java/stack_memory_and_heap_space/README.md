## 스택 메모리와 힙 공간 in Java

### 시작하며

애플리케이션을 최적의 방식으로 실행하기 위해 JVM은 메모리를 스택 메모리와 힙 메모리로 나눕니다. 새 변수와 개체를 선언하거나, 새 메서드를 호출하거나, 문자열을 선언하거나, 유사한 작업을 수행할 때마다 JVM은 스택 메모리 또는 힙 공간에서 이러한 작업에 대한 메모리를 지정합니다.

이 튜토리얼에서는 이러한 메모리 모델에 대해 설명합니다. RAM에 저장되는 방법, 제공하는 기능 및 사용 장소 등 몇 가지 주요 차이점이 있습니다.



### 스택 메모리 in Java

Java의 Stack Memory는 정적 메모리 할당 및 스레드 실행에 사용됩니다. 메소드에 특정된 원시 값과 메소드에서 참조된 힙에 있는 개체에 대한 참조가 포함되어 있습니다.

이 메모리에 대한 액세스는 LIFO(Last-In-First-Out) 순서로 진행됩니다. 새 메서드가 호출될 때마다 스택 맨 위에 원시 변수 및 개체에 대한 참조와 같은 해당 메서드에 특정 값이 포함된 새 블록이 생성됩니다.

메소드가 실행을 마치면 해당하는 스택 프레임이 플러시되고 흐름이 호출 메서드로 돌아가 다음 메서드에 사용할 수 있게 됩니다.



#### 스택 메모리의 중요 특성

지금까지 살펴본 내용 외에도 스택 메모리의 몇 가지 다른 기능은 다음과 같습니다.

- 새로운 방법을 각각 호출하고 반환함에 따라 확장 및 축소됩니다.
- 스택 내부 변수는 생성한 메서드가 실행 중인 경우에만 존재합니다.
- 메서드 실행이 완료되면 자동으로 할당 및 할당 해제됩니다.
- 이 메모리가 가득 차면 Java가 java.lang을 던집니다.스택오버플로 오류입니다.
- 힙 메모리와 비교할 때 이 메모리에 대한 액세스 속도가 빠릅니다.
- 이 메모리는 각 스레드가 자체 스택에서 작동하므로 스레드 안전합니다.



### 힙 공간 in Java

Java의 힙 공간은 런타임에 Java 개체 및 JRE 클래스에 대한 동적 메모리 할당에 사용됩니다. 새 개체는 항상 힙 공간에 생성되고 이 개체에 대한 참조는 스택 메모리에 저장됩니다.

이러한 개체는 전역 액세스 권한을 가지며 응용 프로그램 어디에서나 액세스할 수 있습니다.

이 메모리 모델은 세대라고 불리는 작은 부분으로 더 세분화됩니다. 다음과 같습니다.

- 젊은 세대 – 어디 새로운 모든 개체는 할당되고 고령화된다.이를 채워 주는 사소한 쓰레기 수집이 발생한다.
- 올드나 Tenured 세대 – 어디 오래 살아남은 개체가 저장되어 있다.물체는 젊은 세대에 저장됩니다, 개체의 시대를 위한 문턱 값과 그 임계값에 도달하면 개체는 구세대에 감동을 받는다 설정됩니다.
- 영구세대 – 이의 JVM메타 데이터에 대한 런타임 클래스와 응용 방식.

이 기사에서는 JVM, JRE 및 JDK 간의 차이에도 대해 설명합니다.

힙 메모리의 크기는 요구 사항에 따라 언제든지 조정할 수 있습니다. 더 많은 정보를 원하시면, 이 연결된 백등 기사를 방문하세요.



#### 힙 공간의 주요 특성

지금까지 살펴본 내용 외에도 힙 공간의 몇 가지 다른 기능은 다음과 같습니다.

- 젊은 세대, 구세대 또는 테뉴어 세대, 영구세대가 포함된 복잡한 메모리 관리 기술을 통해 액세스할 수 있습니다.
- 힙 공간이 가득 찬 경우 Java는 java.lang을 던집니다.메모리 부족 오류입니다.
- 이 메모리에 대한 액세스 속도가 스택 메모리보다 상대적으로 느립니다.
- 스택과 달리 이 메모리는 자동으로 할당 해제되지 않습니다. 메모리 사용의 효율성을 유지하기 위해 사용되지 않는 개체를 비우려면 가비지 수집기가 필요합니다.
- 스택과 달리 힙은 스레드 세이프가 아니며 코드를 적절하게 동기화하여 보호해야 합니다.



### 예

지금까지 배운 내용을 바탕으로 간단한 Java 코드를 분석하고 여기에서 메모리를 관리하는 방법을 평가해 보겠습니다.

```java
class Person {
    int id;
    String name;

    public Person(int id, String name) {
        this.id = id;
        this.name = name;
    }
}

public class PersonBuilder {
    private static Person buildPerson(int id, String name) {
        return new Person(id, name);
    }

    public static void main(String[] args) {
        int id = 23;
        String name = "John";
        Person person = null;
        person = buildPerson(id, name);
    }
}
```



다음 단계를 단계별로 분석해 보겠습니다.

1. main() 메서드에 입장하면, = 스택 메모리에 이 메서드의 기본 및 참조를 저장할 공간이 생성됩니다.

   - 정수 ID의 원시 값은 스택 메모리에 직접 저장됩니다.

   - Person 타입의 참조 변수 person도 스택 메모리에 생성되어 힙의 실제 객체를 가리킵니다.

2. main()에서 매개 변수화된 생성자 Person(int, String)에 대한 호출은 이전 스택 위에 추가 메모리를 할당합니다. 이렇게 하면 다음이 저장됩니다.

   - 스택 메모리에 있는 호출 개체의 이 개체 참조입니다.
   - 스택 메모리의 원시 값 ID입니다.
   - 힙 메모리의 문자열 풀에서 실제 문자열을 가리키는 문자열 인수 이름의 참조 변수입니다.

3. 주요 방법은 buildPerson() 정적 메서드를 추가로 호출하는 것인데, 이전 메서드 위에 있는 스택 메모리에서 추가 할당이 수행됩니다. 이렇게 하면 위에서 설명한 방식으로 변수가 다시 저장됩니다.

4. 그러나 사용자 유형의 새로 생성된 개체 사용자의 경우 모든 인스턴스 변수는 힙 메모리에 저장됩니다.



이 할당은 이 다이어그램에 설명되어 있습니다.

![](/Users/addpage/Dev/my-github/study/java/stack_memory_and_heap_space/images/java-heap-stack-diagram.webp)



### 요약

이 기사를 마무리하기 전에 스택 메모리와 힙 공간의 차이점을 간단히 요약해 보겠습니다.

| Parameter   | Stack Memory                                                 | Heap Space                                                   |
| ----------- | ------------------------------------------------------------ | ------------------------------------------------------------ |
| Application | 스택은 스레드가 실행되는 동안 한번에 하나씩  부품에 사용됩니다. | 전체 애플리케이션이 런타임 동안 힙 공간을 사용합니다.        |
| Size        | 스택은 OS에 따라 크기 제한이 있으며 일반적으로 힙보다 작습니다. | 힙에 크기 제한이 없습니다.                                   |
| Storage     | 힙 공간에 생성된 개체에 대한 원시 변수 및 참조만 저장합니다. | 새로 생성된 모든 개체가 여기에 저장됩니다.                   |
| Order       | LIFO(Last-In First-Out) 메모리 할당 시스템을 사용하여 액세스할 수 있습니다. | 이 메모리는 Young Generation, Old 또는 Tenured Generation 및 Permanent Generation을 포함하는 복잡한 메모리 관리 기술을 통해 액세스할 수 있습니다. |
| Life        | 스택 메모리는 현재 메서드가 실행 중인 경우에만 존재합니다.   | 애플리케이션이 실행되는 동안 힙 공간이 존재합니다.           |
| Efficiency  | 힙에 비해 할당 속도가 비교적 빠릅니다.                       | 스택과 비교할 때 할당 속도가 느립니다.                       |
| 할당/해제   | 이 메모리는 메서드가 각각 호출되고 반환되면 자동으로 할당 및 할당 해제됩니다. | 힙 공간은 새 개체가 더 이상 참조되지 않을 때 Gargabe Collector에 의해 생성 및 할당 해제될 때 할당됩니다. |



### 결론

스택과 힙은 Java에서 메모리를 할당하는 두 가지 방법입니다. 이 기사에서는 이 프로그램이 작동하는 방식과 더 나은 Java 프로그램을 개발하기 위해 이 프로그램을 사용해야 하는 시기를 이해했습니다.

Java의 메모리 관리에 대해 자세히 알아보려면 여기를 참조하십시오. 또한 이 글에서 간략하게 설명한 JVM 가비지 수집기에 대해서도 논의했습니다.

### 

## 참조

- [Baeldung 블로그](https://www.baeldung.com/java-stack-heap)